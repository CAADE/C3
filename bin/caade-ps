#!/usr/bin/env node

var program = require('commander');
var Client = require('node-rest-client').Client;
var config = require('./caade-config');
var YAML = require('yamljs');
var _ = require('lodash');

var client = new Client();


program
  .option('-e, --env <environmentName>', 'Launch application in a specific environment')
  .parse(process.argv);

var services = program.args;

var url = config.caadeUrl + "/application/ps";
var application = YAML.load('./caade-app.yaml');
if(application.name) {
  url += "?app=" + application.name
}

if (program.env) {
  url += "&env=" + program.env;
}
if (program.args) {
  url += "&services=" + program.args;
}
// direct way
client.get(url, function (instances, response) {
  // parsed response body as js object
  console.log("ID\tName\tEnv\tState");
  console.log("=====\t======\t======\t======");
  _.each(instances, function(instance) {
    console.log("%d\t%s\t%s\t%s", instance.id, application.name + "-" + instance.name, instance.application.env.name,instance.state);
  });
})
