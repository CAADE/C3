#!/usr/bin/env node

var fs = require('fs');
var YAML = require('yamljs');

var program = require('commander');
var Client = require('node-rest-client').Client;
var config = require('./UHC-config');

var client = new Client();


program
  .option('-u, --username <userName>', 'Initalize the environment with UserName')
  .option('-p, --password <password>', 'Initalize the enrionment with Password')
  .parse(process.argv);

var name = program.args;

var url = config.UHCUrl + "/user/initFile?";

if (program.username) {
  url += "&username=" + program.username;
}
if (program.password) {
  url += "&password=" + program.password;
}

client.get(url, function (data, response) {
  // parsed response body as js object
  if (data.error) {
    console.error("Error:" + data.error);
  }
  else {
    var yamlString = YAML.stringify(data, 4);

    fs.writeFile(".UHC.yaml", yamlString, function (err) {
      if (err) {
        return console.log(err);
      }
      console.log("UHC Initialized");
    });
  }
});
