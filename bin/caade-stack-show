#!/usr/bin/env node

var program = require('commander');
var Client = require('node-rest-client').Client;
var config = require('./caade-config');
var _ = require('lodash');

var client = new Client();

program
  .option('-v, --version <versionNumber>', 'Show an application stack with version')
  .parse(process.argv);

var name = program.args;

var url = config.caadeUrl + "/stack/show?";

if(name) {
  url += "name=" + name[0];
}

if (program.version) {
  url += "&version=" + program.version;
}
client.get(url, function (data, response) {
  // parsed response body as js object
  if(data.error) {
    console.error(data.error);
  }
  else {
    console.log("Name:" + data.stack.name + "\tVersion: " + data.stack.version);
    console.log("Environment\tID\tVersion");
    console.log("===========\t=====\t=====");
    _.each(data.stack.stacklets, function(value,key) {
      console.log(key + "\t\t" + value.id + "\t" + value.version);
    })
  }
});
